# Amazon SP-API 連携Webアプリケーション 要件定義書

## 1. プロジェクト概要

### 1.1 プロジェクト名
Amazon Manager - Amazon SP-API連携Webアプリケーション

### 1.2 目的
Amazon SP-APIを活用して、Amazonセラーの販売業務を効率化するWebアプリケーションを開発する。注文情報の取得・管理、出品情報の表示・管理を中心とした機能を提供する。

### 1.3 対象ユーザー
- 開発者（Amazonセラー）本人のみの単一ユーザーアプリケーション
- マルチテナント機能は不要

## 2. システム要件

### 2.1 機能要件

#### 2.1.1 注文情報管理機能
- SP-APIのOrders APIを使用した注文情報の取得
- 注文一覧の表示
- 注文詳細情報の表示
- 注文ステータスの確認
- 注文データの検索・フィルタリング機能

#### 2.1.2 出品情報管理機能
- SP-APIを使用した出品商品情報の取得
- 商品一覧の表示
- 商品詳細情報の表示
- 在庫状況の確認
- 商品データの検索・フィルタリング機能

#### 2.1.3 データ管理機能
- データの一時キャッシュ（永続化なし）
- API経由での最新データ取得
- データエクスポート機能（CSV、JSON形式）

#### 2.1.4 レビュー依頼機能 ★新機能
- 注文情報からレビュー依頼対象の自動抽出
- 個別およびバッチでのレビュー依頼メール送信
- レビュー依頼送信状況の管理と追跡
- カスタマイズ可能なメールテンプレート
- 送信条件の設定（発送済み、30日以内、未送信など）

### 2.2 非機能要件

#### 2.2.1 技術要件
- フロントエンド: Next.js（React）
- バックエンド: Next.js API Routes
- データ管理: メモリベースキャッシュ（データベース不使用）
- プログラミング言語: TypeScript
- SP-API連携: 直接API連携を使用

#### 2.2.2 パフォーマンス要件
- API呼び出し時のレスポンス時間: 5秒以内
- データ表示の応答速度: 2秒以内
- 大量データ（1000件以上）の処理に対応

#### 2.2.3 セキュリティ要件
- SP-API認証情報の安全な管理
- 環境変数による機密情報の分離
- HTTPS通信の必須化
- メール送信サービスの認証情報管理

#### 2.2.4 キャッシュ要件 ★新機能
- アプリ起動時のデータ自動取得とキャッシュ
- 画面遷移時の高速データ表示
- キャッシュの適切な有効期限管理（デフォルト30分）
- キャッシュクリア機能

## 3. Amazon SP-API 仕様

### 3.1 認証方式
- AWS IAM設定や署名は不要（セラー専用アプリのため）
- ソリューションプロバイダー登録は不要
- LWA（Login with Amazon）トークンベース認証

### 3.2 使用予定API

#### 3.2.1 Orders API
- 主要エンドポイント: `getOrders`
- 用途: 注文情報の取得、注文履歴の管理
- 参考: https://developer-docs.amazon.com/sp-api/lang-ja_JP/docs/orders-api#use-cases

#### 3.2.2 Catalog Items API
- 用途: 商品カタログ情報の取得

#### 3.2.3 Inventory API  
- 用途: 在庫情報の取得

### 3.3 API呼び出しフロー
1. SP-APIクライアントの初期化
2. リフレッシュトークンを使用したアクセストークンの取得
3. 取得したアクセストークンでのAPI呼び出し実行

## 4. システム構成

### 4.1 技術スタック
- **フレームワーク**: Next.js 14+ (App Router)
- **言語**: TypeScript
- **データベース**: Supabase (PostgreSQL)
- **スタイリング**: Tailwind CSS
- **SP-API連携**: amazon-sp-api（コミュニティライブラリ）
- **デプロイ**: Vercel（予定）

### 4.2 アーキテクチャ
- サーバーサイドレンダリング（SSR）とクライアントサイドレンダリング（CSR）のハイブリッド
- API Routesを使用したバックエンド処理
- メモリベースキャッシュによる高速データアクセス
- Amazon SP-APIとの直接連携（データベース不使用）

## 5. データ設計

### 5.1 主要データエンティティ
- 注文情報（Orders）
- 商品情報（Products） 
- 在庫情報（Inventory）
- API設定情報（API Credentials）

### 5.2 データ管理方針
- SP-APIから取得したデータはメモリキャッシュで一時保存
- アプリ起動時の自動データ取得とキャッシュ
- データ永続化は行わず、常に最新データをAPI経由で取得
- キャッシュ有効期限による適切なデータ更新

## 6. 開発・運用要件

### 6.1 開発環境
- Node.js 18+
- npm/yarn
- Git バージョン管理
- VSCode推奨

### 6.2 品質管理
- TypeScript型安全性の確保
- ESLint + Prettierによるコード品質管理
- 単体テスト・統合テストの実装

### 6.3 運用要件
- 開発者単体での運用
- ログ監視機能
- エラーハンドリング機能
- API制限対応（レート制限）

## 7. リスク・制約事項

### 7.1 技術的制約
- Amazon SP-APIの利用制限・レート制限への対応が必要
- API仕様変更への追従が必要

### 7.2 運用上のリスク
- Amazon側のAPI仕様変更による影響
- 認証トークンの有効期限管理
- データ取得量の制限

### 7.3 対応策
- エラーハンドリングの充実
- API呼び出し回数の最適化
- 定期的なライブラリアップデート

## 8. 開発スケジュール概要

### フェーズ1: 基盤構築
- Next.jsプロジェクトセットアップ
- メモリキャッシュシステム構築
- SP-API認証設定

### フェーズ2: 注文管理機能
- Orders API連携実装
- 注文一覧・詳細画面の実装

### フェーズ3: 商品管理機能
- Catalog Items API連携実装  
- 商品一覧・詳細画面の実装

### フェーズ4: レビュー依頼機能 ★追加フェーズ
- レビュー依頼対象の自動判定ロジック実装
- メール送信サービス連携
- 個別・バッチ送信機能の実装
- データキャッシュシステムの構築

### フェーズ5: 機能拡張・最適化
- データエクスポート機能
- パフォーマンス最適化
- UI/UX改善

## 9. 成果物

### 9.1 システム成果物
- Webアプリケーション本体
- データベース設計書
- API仕様書
- システム運用マニュアル

### 9.2 ドキュメント成果物
- システム仕様書
- データベース設計書
- API連携仕様書
- 運用手順書